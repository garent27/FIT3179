{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 800,
  "height": 400,
  "background": "#ffffff",
  "description": "Interactive lollipop chart showing fastest Rubik's Cube solves with highlighting on hover and selection",
  "title": {
    "text": "Top 8 Fastest Rubik's Cube Single Solves of All Time",
    "fontSize": 20,
    "anchor": "start"
  },
  "data": {
    "url": "data/top10_single_per_country.csv",
    "format": {"type": "tsv"}
  },
  "transform": [
    {
      "filter": "datum.eventId == '333'"
    },
    {
      "calculate": "toNumber(datum.single_seconds)",
      "as": "time_numeric"
    },
    {
      "window": [
        {
          "op": "row_number",
          "as": "global_rank"
        }
      ],
      "sort": [
        {
          "field": "time_numeric",
          "order": "ascending"
        }
      ]
    },
    {
      "filter": "datum.global_rank <= 8"
    },
    {
      "calculate": "datum.name + ' (' + datum.countryId + ')'",
      "as": "solver_country"
    }
  ],
  "layer": [
    {
      "params": [
        {
          "name": "highlight",
          "select": {"type": "point", "on": "mouseover"}
        },
        {"name": "select", "select": "point"}
      ],
      "mark": {
        "type": "circle",
        "cursor": "pointer",
        "size": 300,
        "stroke": "white",
        "strokeWidth": 1,
        "tooltip": true
      },
      "encoding": {
        "x": {
          "field": "time_numeric",
          "type": "quantitative",
          "title": "Single Solve Time (seconds)",
          "scale": {
            "domain": [0, 5.0],
            "nice": false
          },
          "axis": {
            "grid": true,
            "gridColor": "#ffffff",
            "labelFontSize": 12,
            "titleFontSize": 14,
            "format": ".2f",
            "domain": true,
            "domainWidth": 1.5,
            "domainColor": "#333",
            "tickWidth": 1.5,
            "tickColor": "#333"
          }
        },
        "y": {
          "field": "solver_country",
          "type": "nominal",
          "sort": {
            "field": "time_numeric",
            "order": "ascending"
          },
          "title": "Solver",
          "axis": {
            "labelFontSize": 13,
            "titleFontSize": 14,
            "labelLimit": 250,
            "domain": true,
            "domainWidth": 1.5,
            "domainColor": "#333",
            "tickWidth": 1.5,
            "tickColor": "#333",
            "gridColor": "#ffffff"
          }
        },
        "color": {
          "condition": {
            "param": "select",
            "field": "time_numeric",
            "type": "quantitative",
            "scale": {
              "range": ["#ef4444", "#f97316", "#eab308", "#22c55e", "#06b6d4", "#3b82f6", "#8b5cf6", "#ec4899"]
            }
          },
          "value": "#3b82f6"
        },
        "tooltip": [
          {"field": "global_rank", "type": "ordinal", "title": "World Rank"},
          {"field": "name", "type": "nominal", "title": "Solver"},
          {"field": "countryId", "type": "nominal", "title": "Country"},
          {"field": "time_numeric", "type": "quantitative", "title": "Time (seconds)", "format": ".3f"},
          {"field": "personId", "type": "nominal", "title": "WCA ID"}
        ]
      }
    },
    {
      "mark": {"type": "rule"},
      "encoding": {
        "x": {
          "field": "time_numeric",
          "type": "quantitative"
        },
        "x2": {"value": 0},
        "y": {
          "field": "solver_country",
          "type": "nominal",
          "sort": {
            "field": "time_numeric",
            "order": "ascending"
          }
        },
        "color": {
          "condition": {
            "param": "select",
            "field": "time_numeric",
            "type": "quantitative",
            "scale": {
              "range": ["#ef4444", "#f97316", "#eab308", "#22c55e", "#06b6d4", "#3b82f6", "#8b5cf6", "#ec4899"]
            }
          },
          "value": "#cccccc"
        },
        "strokeWidth": {
          "condition": [
            {
              "param": "select",
              "empty": false,
              "value": 3
            },
            {
              "param": "highlight",
              "empty": false,
              "value": 2
            }
          ],
          "value": 1
        }
      }
    },
    {
      "mark": {"type": "text", "align": "left", "dx": 10, "dy": 0},
      "encoding": {
        "x": {
          "field": "time_numeric",
          "type": "quantitative"
        },
        "y": {
          "field": "solver_country",
          "type": "nominal",
          "sort": {
            "field": "time_numeric",
            "order": "ascending"
          }
        },
        "text": {
          "field": "time_numeric",
          "type": "quantitative",
          "format": ".2f"
        },
        "opacity": {
          "condition": {
            "param": "select",
            "value": 1
          },
          "value": 0
        }
      }
    }
  ],
  "config": {
    "view": {
      "stroke": null,
      "fill": "#ffffff"
    },
    "axis": {
      "labelColor": "#333",
      "titleColor": "#333",
      "gridColor": "#ffffff",
      "domainColor": "#333",
      "domainWidth": 1.5,
      "tickColor": "#333"
    }
  }
}
