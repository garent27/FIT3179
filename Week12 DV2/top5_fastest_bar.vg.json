{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "background": "#f9f9f9",
  "params": [
    {
      "name": "country_selection",
      "value": "World"
    }
  ],
  "title": {
    "text": {
      "expr": "country_selection == 'World' ? 'Top 10 Fastest Rubik\\'s Cube Single Solves Ever' : 'Top 10 Fastest Solves in ' + country_selection"
    },
    "fontSize": 20,
    "anchor": "start"
  },
  "width": 600,
  "height": 400,
  "padding": {"left": 100, "right": 20, "top": 30, "bottom": 20},
  "data": {
    "url": "data/top10_unique_per_country.csv"
  },
  "transform": [
    {
      "filter": "country_selection == 'World' || datum.countryId == country_selection"
    },
    {
      "calculate": "toNumber(datum.single_seconds)",
      "as": "time_numeric"
    },
    {
      "aggregate": [
        {
          "op": "min",
          "field": "time_numeric",
          "as": "best_time"
        }
      ],
      "groupby": ["personId", "name", "countryId"]
    },
    {
      "window": [
        {
          "op": "row_number",
          "as": "country_rank"
        }
      ],
      "sort": [
        {
          "field": "best_time",
          "order": "ascending"
        }
      ]
    },
    {
      "filter": "datum.country_rank <= 10"
    },
    {
      "calculate": "datum.name",
      "as": "solver_name"
    },
    {
      "calculate": "'#' + datum.country_rank + ': ' + datum.name",
      "as": "rank_solver"
    }
  ],
  "layer": [
    {
      "mark": {
        "type": "rule",
        "color": "#666666",
        "strokeWidth": 1
      },
      "encoding": {
        "x": {
          "field": "best_time",
          "type": "quantitative",
          "title": "Best Solve Time (seconds)",
          "scale": {
            "zero": true,
            "nice": true
          },
          "axis": {
            "labelFontSize": 12,
            "titleFontSize": 14,
            "format": ".2f",
            "grid": true,
            "gridColor": "#f9f9f9",
            "domain": true,
            "domainWidth": 1.5,
            "domainColor": "#333",
            "tickWidth": 1.5,
            "tickColor": "#333"
          }
        },
        "x2": {"value": 0},
        "y": {
          "field": "rank_solver",
          "type": "nominal",
          "sort": {
            "field": "best_time",
            "order": "ascending"
          },
          "title": "World Rank & Solver",
          "axis": {
            "labelFontSize": 13,
            "titleFontSize": 14,
            "labelLimit": 250,
            "domain": true,
            "domainWidth": 1.5,
            "domainColor": "#333",
            "tickWidth": 1.5,
            "tickColor": "#333",
            "gridColor": "#f9f9f9"
          }
        }
      }
    },
    {
      "mark": {
        "type": "circle",
        "size": 300,
        "opacity": 0.9,
        "stroke": "white",
        "strokeWidth": 1
      },
      "encoding": {
        "x": {
          "field": "best_time",
          "type": "quantitative"
        },
        "y": {
          "field": "rank_solver",
          "type": "nominal",
          "sort": {
            "field": "best_time",
            "order": "ascending"
          }
        },
        "color": {
          "value": "#4285F4",
          "legend": null
        },
        "tooltip": [
          {"field": "country_rank", "type": "ordinal", "title": "Rank"},
          {"field": "name", "type": "nominal", "title": "Solver"},
          {"field": "countryId", "type": "nominal", "title": "Country"},
          {"field": "best_time", "type": "quantitative", "title": "Best Time (seconds)", "format": ".3f"},
          {"field": "personId", "type": "nominal", "title": "WCA ID"}
        ]
      }
    }
  ],
  "config": {
    "view": {
      "stroke": null,
      "fill": "#f9f9f9"
    },
    "axis": {
      "labelColor": "#333",
      "titleColor": "#333",
      "domainColor": "#333",
      "domainWidth": 1.5,
      "tickColor": "#333",
      "tickWidth": 1.5,
      "gridColor": "#ffffff"
    }
  }
}
